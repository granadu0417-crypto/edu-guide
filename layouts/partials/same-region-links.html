{{- /* 같은 지역 콘텐츠 연결 */ -}}
{{- $currentPage := . -}}
{{- $currentCity := "" -}}
{{- $currentType := .Type -}}

{{- /* 현재 페이지의 구 정보 가져오기 */ -}}
{{- with .Params.cities -}}
  {{- $currentCity = index . 0 -}}
{{- end -}}

{{- if $currentCity -}}
{{- /* 같은 구의 다른 콘텐츠 찾기 */ -}}
{{- $sameRegionPages := slice -}}
{{- $otherSubjectPages := slice -}}

{{- /* 파일명에서 과목 추출 */ -}}
{{- $currentSubject := "" -}}
{{- $currentDong := "" -}}
{{- if .File -}}
  {{- $filename := .File.BaseFileName -}}
  {{- if strings.Contains $filename "-math" -}}
    {{- $currentSubject = "math" -}}
  {{- else if strings.Contains $filename "-english" -}}
    {{- $currentSubject = "english" -}}
  {{- end -}}
  {{- /* 동 이름 추출 시도 */ -}}
  {{- $parts := split $filename "-" -}}
  {{- if ge (len $parts) 2 -}}
    {{- $currentDong = index $parts 1 -}}
  {{- end -}}
{{- end -}}

{{- range where .Site.RegularPages "Type" $currentType -}}
  {{- if ne . $currentPage -}}
    {{- $pageCity := "" -}}
    {{- with .Params.cities -}}
      {{- $pageCity = index . 0 -}}
    {{- end -}}
    {{- if eq $pageCity $currentCity -}}
      {{- /* 같은 과목인지 확인 */ -}}
      {{- $pageSubject := "" -}}
      {{- if .File -}}
        {{- $fn := .File.BaseFileName -}}
        {{- if strings.Contains $fn "-math" -}}
          {{- $pageSubject = "math" -}}
        {{- else if strings.Contains $fn "-english" -}}
          {{- $pageSubject = "english" -}}
        {{- end -}}
      {{- end -}}
      {{- if and $currentSubject (eq $pageSubject $currentSubject) -}}
        {{- $sameRegionPages = $sameRegionPages | append . -}}
      {{- else if and $currentSubject (ne $pageSubject $currentSubject) (ne $pageSubject "") -}}
        {{- $otherSubjectPages = $otherSubjectPages | append . -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{- /* 표시할 페이지가 있으면 출력 */ -}}
{{- if or (gt (len $sameRegionPages) 0) (gt (len $otherSubjectPages) 0) -}}
<section class="same-region-links">
  {{- /* 같은 과목, 다른 동 */ -}}
  {{- if gt (len $sameRegionPages) 0 -}}
  <div class="region-link-group">
    <h3>{{ $currentCity }} 다른 동 {{ if eq $currentSubject "math" }}수학{{ else }}영어{{ end }}과외</h3>
    <div class="region-link-list">
      {{- range first 6 (shuffle $sameRegionPages) -}}
      <a href="{{ .RelPermalink }}" class="region-link-item">
        <span class="link-title">{{ .Title | truncate 35 }}</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
      </a>
      {{- end -}}
    </div>
  </div>
  {{- end -}}

  {{- /* 다른 과목 */ -}}
  {{- if gt (len $otherSubjectPages) 0 -}}
  <div class="region-link-group">
    <h3>{{ $currentCity }} {{ if eq $currentSubject "math" }}영어{{ else }}수학{{ end }}과외도 확인하세요</h3>
    <div class="region-link-list">
      {{- range first 4 (shuffle $otherSubjectPages) -}}
      <a href="{{ .RelPermalink }}" class="region-link-item alt">
        <span class="link-title">{{ .Title | truncate 35 }}</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
      </a>
      {{- end -}}
    </div>
  </div>
  {{- end -}}
</section>

<style>
.same-region-links {
  margin: 40px 0;
  padding: 28px;
  background: #f8f9fa;
  border-radius: 16px;
}

.region-link-group {
  margin-bottom: 24px;
}

.region-link-group:last-child {
  margin-bottom: 0;
}

.region-link-group h3 {
  font-size: 16px;
  font-weight: 700;
  color: #495057;
  margin-bottom: 16px;
  padding-bottom: 12px;
  border-bottom: 2px solid #e9ecef;
}

.region-link-list {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
}

.region-link-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: white;
  border: 1px solid #e9ecef;
  border-radius: 8px;
  text-decoration: none;
  transition: all 0.2s ease;
}

.region-link-item:hover {
  border-color: #667eea;
  background: #f8f9ff;
  transform: translateX(4px);
}

.region-link-item.alt:hover {
  border-color: #10b981;
  background: #f0fdf4;
}

.link-title {
  font-size: 14px;
  font-weight: 600;
  color: #495057;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.region-link-item svg {
  flex-shrink: 0;
  color: #adb5bd;
  transition: color 0.2s;
}

.region-link-item:hover svg {
  color: #667eea;
}

.region-link-item.alt:hover svg {
  color: #10b981;
}

@media (max-width: 768px) {
  .same-region-links {
    padding: 20px;
    margin: 32px 0;
  }

  .region-link-list {
    grid-template-columns: 1fr;
  }

  .region-link-item {
    padding: 10px 14px;
  }

  .link-title {
    font-size: 13px;
  }
}
</style>
{{- end -}}
{{- end -}}
