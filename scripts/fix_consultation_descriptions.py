#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
consultation 폴더의 중복 description 수정 스크립트
각 파일의 title에 맞는 고유한 description 생성
"""

from pathlib import Path
import re

# Title 키워드별 맞춤 description 템플릿
DESCRIPTION_TEMPLATES = {
    # 기본 상담 시리즈 (1-20)
    "학습 방향 설정": "명확한 학습 목표와 로드맵이 필요하신가요? 현재 실력 진단부터 단계별 학습 계획까지, 체계적인 학습 방향 설정 상담으로 효율적인 공부의 첫걸음을 시작하세요.",
    "학부모 교육": "자녀 학습 지도가 막막하신가요? 학부모를 위한 전문 교육 상담으로 효과적인 학습 지도 방법과 자녀와의 소통 전략을 배워보세요.",
    "성적 향상": "성적이 정체되어 고민이신가요? 체계적인 진단과 분석을 통해 단기간에 성적을 향상시킬 수 있는 맞춤형 학습 전략을 제시합니다.",
    "학습 환경": "집중하기 어려운 학습 환경 때문에 고민이신가요? 최적의 공부 환경 조성 방법과 집중력을 높이는 공간 구성 전략을 알려드립니다.",
    "독서 습관": "독서 습관 형성이 어려우신가요? 흥미 유발부터 독해력 향상까지, 평생 도움이 되는 효과적인 독서 전략을 제공합니다.",
    "노트 필기": "필기 방법이 고민이신가요? 체계적인 노트 정리 전략과 효율적인 필기 기법으로 학습 효과를 극대화하세요.",
    "복습 전략": "복습은 하는데 잊어버리시나요? 장기 기억으로 남는 과학적 복습 전략과 반복 학습 방법을 알려드립니다.",
    "예습 방법": "예습을 효율적으로 하고 싶으신가요? 선행 학습 효율화 전략과 체계적인 예습 방법으로 수업 이해도를 높이세요.",
    "오답노트": "같은 실수를 반복하시나요? 효과적인 오답노트 활용 전략과 실수 예방 시스템으로 완벽한 학습을 만들어드립니다.",
    "학습 자료": "어떤 교재가 좋을지 고민이신가요? 학습 수준과 목표에 맞는 효과적인 교재 선택 가이드를 제공합니다.",
    "온라인 학습": "온라인 학습 효율이 떨어지시나요? 원격 학습 환경에서 집중력과 학습 효과를 높이는 실전 전략을 알려드립니다.",
    "진로 탐색": "우리 아이의 적성과 진로가 궁금하신가요? 적성 검사, 흥미 분석, 진학 경로 설계까지 전문가와 함께하는 체계적인 진로 상담으로 미래를 준비하세요.",
    "학원 선택": "우리 아이에게 맞는 학원을 찾고 계신가요? 학원 선택 기준부터 평가 방법까지, 효과적인 학원 선택 컨설팅을 제공합니다.",
    "내신 관리": "학교 성적 관리가 어려우신가요? 학년별 특성을 고려한 내신 관리 전략으로 효과적인 성적 향상을 경험하세요. 과목별 맞춤 학습법과 시험 대비 전략을 제공합니다.",
    "학습 습관": "올바른 공부 습관 형성이 고민이신가요? 집중력 향상, 자기주도 학습, 시간 관리까지 우리 아이 성향에 맞는 효율적인 학습 습관을 만들어드립니다.",
    "시간 관리": "공부 시간 대비 성과가 부족하신가요? 효율적인 시간 관리와 학습 계획 수립으로 같은 시간에 더 큰 학습 효과를 얻는 방법을 알려드립니다.",
    "집중력 향상": "공부할 때 집중이 안 되시나요? 집중력을 높이는 과학적 방법과 몰입도를 높이는 실전 전략으로 학습 효율을 극대화하세요.",
    "학습 동기": "공부 의욕이 떨어진 자녀가 걱정되시나요? 동기 부여부터 목표 설정까지, 자녀의 학습 열정을 되찾는 심리 상담을 제공합니다.",
    "수학 학습": "수학 성적이 고민이신가요? 개념 이해부터 문제 해결력까지, 수학 실력을 체계적으로 향상시키는 맞춤형 수학 학습 전략을 제공합니다.",
    "영어 학습": "영어 실력 향상이 필요하신가요? 듣기, 말하기, 읽기, 쓰기 영역별 맞춤 학습법으로 영어 실력을 효과적으로 키워드립니다.",
    "과학 학습": "과학 과목이 어려우신가요? 개념 이해부터 실험, 탐구 활동까지 과학 학습의 모든 것을 체계적으로 안내해드립니다.",
    "국어 학습": "국어 독해와 문법이 어려우신가요? 지문 분석 능력부터 어휘력, 문법까지 국어 실력을 종합적으로 향상시키는 학습법을 제공합니다.",
    "사회 학습": "사회 과목 학습이 막막하신가요? 암기부터 이해, 응용까지 사회 과목 고득점을 위한 효과적인 학습 전략을 알려드립니다.",

    # 심화 상담 시리즈 (6-10, 16-20)
    "성적 향상": "성적이 정체되어 고민이신가요? 체계적인 진단과 분석을 통해 단기간에 성적을 향상시킬 수 있는 맞춤형 학습 전략을 제시합니다.",
    "입시 전략": "대입 준비가 막막하신가요? 학년별 입시 준비 전략과 대학별 전형 분석으로 합격 가능성을 높이는 맞춤형 입시 컨설팅을 제공합니다.",
    "학습 동기": "공부 의욕이 떨어진 자녀가 걱정되시나요? 동기 부여부터 목표 설정까지, 자녀의 학습 열정을 되찾는 심리 상담을 제공합니다.",
    "학습 부진": "학습 부진으로 고민이신가요? 근본 원인 분석부터 맞춤형 해결 방안까지, 학습 부진 탈출을 위한 전문 상담을 제공합니다.",
    "특목고": "특목고 진학을 준비하시나요? 특목고별 전형 분석과 맞춤형 준비 전략으로 합격의 꿈을 이루도록 도와드립니다.",

    # 실전 과정 시리즈 (21-35) - 더 구체적으로
    "실전 학습 방향": "실전 단계의 학습 방향 설정이 필요하신가요? 구체적인 실행 계획과 단계별 체크리스트로 확실한 학습 성과를 만들어드립니다.",
    "실전 진로 탐색": "진로 결정을 앞두고 계신가요? 실전 진로 상담으로 구체적인 진학 경로와 준비 방법을 제시하여 명확한 진로 결정을 돕습니다.",
    "실전 내신 관리": "실전 내신 관리 전략이 필요하신가요? 학교별, 과목별 특성을 고려한 실전 내신 대비 전략으로 목표 성적을 달성하세요.",
    "실전 학습 습관": "실전에서 통하는 학습 습관이 필요하신가요? 구체적인 실천 방법과 점검 시스템으로 확실한 습관 형성을 도와드립니다.",
    "실전 시간 관리": "효율적인 실전 시간 관리가 필요하신가요? 과목별, 일정별 시간 배분 전략과 실천 방법으로 학습 효율을 극대화하세요.",
    "실전 집중력": "시험에서 집중력을 최대한 발휘하고 싶으신가요? 실전 상황에서 집중력을 높이는 구체적인 방법과 몰입 기법을 알려드립니다.",
    "실전 학습 동기": "학습 동기를 실천으로 옮기고 싶으신가요? 구체적인 목표 설정과 실행 시스템으로 지속 가능한 자기주도 학습을 만들어드립니다.",
    "실전 스트레스": "시험 스트레스 관리가 필요하신가요? 실전 상황에서 압박감을 줄이고 실력을 100% 발휘하는 멘탈 관리 전략을 제공합니다.",
    "실전 암기": "효과적인 암기 전략이 필요하신가요? 장기 기억으로 남는 과학적 암기법과 실전 적용 방법을 알려드립니다.",
    "실전 문제": "문제 풀이 실력 향상이 필요하신가요? 유형별 접근 전략과 실전 문제 해결 기법으로 시험 점수를 높이세요.",
    "실전 모의고사": "모의고사 활용법이 궁금하신가요? 실전처럼 연습하고 효과적으로 분석하는 모의고사 완전 정복 전략을 제공합니다.",
    "실전 수능": "수능 실전 대비가 필요하신가요? 영역별 시간 관리부터 문제 풀이 전략까지 수능 고득점을 위한 실전 노하우를 알려드립니다.",
    "실전 논술": "논술 실전 대비가 필요하신가요? 주제 분석부터 답안 작성까지 논술 고득점을 위한 체계적인 준비 전략을 제공합니다.",
    "실전 면접": "입시 면접 실전 대비가 필요하신가요? 예상 질문 분석부터 답변 전략까지 면접 합격을 위한 완벽한 준비를 도와드립니다.",
    "실전 자소서": "자기소개서 작성이 막막하신가요? 합격하는 자소서의 구조와 작성법을 단계별로 안내해드립니다.",
}

def get_level_suffix(file_number):
    """파일 번호에 따른 레벨 접미사"""
    if file_number <= 20:
        return " 기초 단계부터 차근차근 시작하세요."
    elif file_number <= 40:
        return " 실전에서 바로 활용 가능한 전략을 제공합니다."
    elif file_number <= 60:
        return " 심화 과정으로 한 단계 더 성장하세요."
    else:
        return " 최고 수준의 고급 전략으로 완성도를 높이세요."

def generate_unique_description(title, file_number):
    """Title과 파일 번호 기반으로 고유한 description 생성"""
    title = title.strip()

    # 각 키워드별로 매칭
    for keyword, template in DESCRIPTION_TEMPLATES.items():
        if keyword in title:
            # 레벨 접미사 추가
            level_suffix = get_level_suffix(file_number)
            return template + level_suffix

    # 기본 fallback
    return f"{title}에 대한 전문가의 맞춤형 교육 컨설팅을 제공합니다. 체계적인 분석과 실천 가능한 전략으로 학습 목표 달성을 도와드립니다."

def fix_description(file_path):
    """파일의 description을 title 기반으로 고유하게 수정"""
    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()

        if not content.startswith('---'):
            return False

        parts = content.split('---', 2)
        if len(parts) < 3:
            return False

        front_matter = parts[1]
        body = parts[2]

        # 파일 번호 추출 (consultation-guide-23.md → 23)
        file_number = 1
        number_match = re.search(r'consultation-guide-(\d+)', str(file_path))
        if number_match:
            file_number = int(number_match.group(1))

        # Title 추출
        title_match = re.search(r'^title:\s*(.+)$', front_matter, re.MULTILINE)
        if not title_match:
            return False

        title = title_match.group(1).strip()

        # 새 description 생성 (파일 번호 포함)
        new_description = generate_unique_description(title, file_number)

        # Description 교체
        desc_pattern = r'^description:.*?(?=\n[a-z_]+:|\ntags:)'
        new_desc = f'description: {new_description}'

        new_front_matter = re.sub(desc_pattern, new_desc, front_matter, flags=re.MULTILINE | re.DOTALL)

        # 파일 저장
        new_content = f"---{new_front_matter}---{body}"

        with open(file_path, 'w', encoding='utf-8') as f:
            f.write(new_content)

        return True

    except Exception as e:
        print(f"❌ 오류: {file_path.name} - {e}")
        return False

def main():
    content_dir = Path('content/consultation')

    print("🔧 Consultation 폴더 description 고유화 시작...\n")

    # 모든 consultation-guide-*.md 파일 처리
    fixed_count = 0

    for md_file in sorted(content_dir.glob('consultation-guide-*.md')):
        if fix_description(md_file):
            fixed_count += 1
            if fixed_count <= 10:
                print(f"✅ [{fixed_count}] {md_file.name}")

    print(f"\n{'=' * 80}")
    print(f"📊 Description 고유화 완료")
    print(f"{'=' * 80}")
    print(f"수정된 파일: {fixed_count}개")
    print(f"{'=' * 80}")

if __name__ == '__main__':
    main()
