#!/usr/bin/env python3
"""경기도 콘텐츠 리라이팅 - 표현 풀 적용"""

import os
import re
import glob

# 서두 표현 풀 (30개)
INTRO_POOL = [
    "수학 점수, 올리고 싶으시죠?",
    "수학 성적이 갑자기 떨어졌나요?",
    "고등학교 수학, 왜 이렇게 어려운 걸까요?",
    "수학 때문에 머리 아프시죠?",
    "내 아이 수학, 왜 이렇게 안 오르는 걸까요?",
    "수학 포기하려고요? 잠깐만요.",
    "고등학교 올라오니 수학이 안 되시나요?",
    "중학교 때는 잘했는데, 지금은 왜 안 되는 걸까요?",
    "수학 성적표 보고 한숨 쉬셨나요?",
    "고등학교 수학, 어디서부터 손대야 할지 막막하시죠?",
    "수학 실력, 지금 바로 키울 수 있습니다.",
    "수포자가 되기 전에, 지금 잡으면 됩니다.",
    "지금 시작하면 충분히 따라잡을 수 있습니다.",
    "수학은 방법만 알면 누구나 오를 수 있습니다.",
    "늦지 않았습니다. 지금 시작하세요.",
    "수학 실력, 3개월이면 달라집니다.",
    "포기하기엔 아직 이릅니다.",
    "제대로 배우면 수학도 재밌어집니다.",
    "1등급, 불가능한 꿈이 아닙니다.",
    "수학 자신감, 되찾을 수 있습니다.",
    "고등학교 수학은 중학교와 차원이 다릅니다.",
    "고등학생이라면 알아야 할 수학 공부법이 있습니다.",
    "내신, 만만치 않습니다. 제대로 준비하세요.",
    "고등 수학, 개념부터 다시 잡아야 합니다.",
    "수능 수학 1등급, 전략이 필요합니다.",
    "내신과 수능을 동시에 잡는 방법이 있습니다.",
    "고등학교 수학이 어려운 이유가 있습니다.",
    "고등학교 시험은 특별한 대비가 필요합니다.",
    "킬러 문항, 풀 수 있는 방법이 있습니다.",
    "수학은 혼자 공부하기 어려운 과목입니다.",
]

# 영어 서두 표현 풀 (30개)
ENGLISH_INTRO_POOL = [
    "영어 성적이 오르지 않아 고민이신가요?",
    "수능 영어 1등급, 생각보다 어렵지 않습니다.",
    "영어는 꾸준함이 답입니다. 지금 시작하세요.",
    "고등학교 영어, 막막하다면 함께 시작해요.",
    "영어 때문에 대학 못 가면 너무 억울하지 않나요?",
    "영어 점수, 왜 이렇게 안 오르는 걸까요?",
    "영어 포기하려고요? 아직 이릅니다.",
    "고등학교 올라오니 영어가 갑자기 어려워졌나요?",
    "영어 성적표 보고 한숨 쉬셨나요?",
    "영어 공부, 어디서부터 시작해야 할지 모르겠다면",
    "영어 실력, 지금 바로 키울 수 있습니다.",
    "영어 자신감, 되찾을 수 있습니다.",
    "지금 시작하면 영어도 충분히 잡을 수 있습니다.",
    "영어는 방법만 알면 누구나 오를 수 있습니다.",
    "늦지 않았습니다. 영어, 지금 시작하세요.",
    "영어 실력, 3개월이면 달라집니다.",
    "포기하기엔 아직 이릅니다. 영어도 마찬가지입니다.",
    "제대로 배우면 영어도 재밌어집니다.",
    "영어 1등급, 불가능한 꿈이 아닙니다.",
    "고등학교 영어는 중학교와 완전히 다릅니다.",
    "고등학생이라면 알아야 할 영어 공부법이 있습니다.",
    "영어 내신, 만만치 않습니다. 제대로 준비하세요.",
    "고등 영어, 문법과 독해를 함께 잡아야 합니다.",
    "수능 영어 1등급, 전략이 필요합니다.",
    "내신과 수능 영어를 동시에 잡는 방법이 있습니다.",
    "고등학교 영어가 어려운 이유가 있습니다.",
    "영어 시험은 특별한 대비가 필요합니다.",
    "고난도 독해, 풀 수 있는 방법이 있습니다.",
    "영어는 혼자 공부하기 어려운 과목입니다.",
    "문법과 독해 실력을 균형 있게 키워야 합니다.",
]

# 중등 수학 서두 풀 (30개)
MIDDLE_MATH_INTRO_POOL = [
    "중학교 수학이 갑자기 어려워졌나요?",
    "수학 성적이 떨어지기 시작했다면, 지금 잡아야 합니다.",
    "중학교 수학, 기초가 흔들리면 안 됩니다.",
    "수학 때문에 고민이신가요?",
    "내 아이 수학, 왜 갑자기 안 되는 걸까요?",
    "수학 포기? 아직 이릅니다.",
    "중학교 들어오니 수학이 어려워졌나요?",
    "초등학교 때는 잘했는데, 지금은 왜 안 되나요?",
    "수학 성적표 보고 걱정되셨나요?",
    "중학교 수학, 어디서부터 손대야 할지 막막하시죠?",
    "수학 실력, 지금 바로 키울 수 있습니다.",
    "지금 시작하면 충분히 따라잡을 수 있습니다.",
    "수학은 방법만 알면 누구나 오릅니다.",
    "늦지 않았습니다. 지금 시작하세요.",
    "수학 실력, 3개월이면 달라집니다.",
    "포기하기엔 아직 이릅니다.",
    "제대로 배우면 수학도 재밌어집니다.",
    "수학 자신감, 되찾을 수 있습니다.",
    "중학교 수학은 초등학교와 다릅니다.",
    "중학생이라면 알아야 할 수학 공부법이 있습니다.",
    "내신, 만만치 않습니다. 제대로 준비하세요.",
    "중등 수학, 개념부터 다시 잡아야 합니다.",
    "내신 1등급, 전략이 필요합니다.",
    "학교 시험 대비, 제대로 해야 합니다.",
    "중학교 수학이 어려운 이유가 있습니다.",
    "중학교 시험은 특별한 대비가 필요합니다.",
    "서술형 문제, 풀 수 있는 방법이 있습니다.",
    "수학은 혼자 공부하기 어려운 과목입니다.",
    "기초를 탄탄히 다져야 고등학교에서 수월합니다.",
    "수학 기초, 중학교 때 확실히 잡아야 합니다.",
]

# 중등 영어 서두 풀 (30개)
MIDDLE_ENGLISH_INTRO_POOL = [
    "영어 성적이 오르지 않아 고민이신가요?",
    "중학교 영어, 기초가 중요합니다.",
    "영어는 꾸준함이 답입니다. 지금 시작하세요.",
    "중학교 영어, 막막하다면 함께 시작해요.",
    "영어 때문에 고민이신가요?",
    "영어 점수, 왜 이렇게 안 오르는 걸까요?",
    "영어 포기하려고요? 아직 이릅니다.",
    "중학교 들어오니 영어가 갑자기 어려워졌나요?",
    "영어 성적표 보고 한숨 쉬셨나요?",
    "영어 공부, 어디서부터 시작해야 할지 모르겠다면",
    "영어 실력, 지금 바로 키울 수 있습니다.",
    "영어 자신감, 되찾을 수 있습니다.",
    "지금 시작하면 영어도 충분히 잡을 수 있습니다.",
    "영어는 방법만 알면 누구나 오릅니다.",
    "늦지 않았습니다. 영어, 지금 시작하세요.",
    "영어 실력, 3개월이면 달라집니다.",
    "포기하기엔 아직 이릅니다.",
    "제대로 배우면 영어도 재밌어집니다.",
    "영어 1등급, 불가능한 꿈이 아닙니다.",
    "중학교 영어는 초등학교와 완전히 다릅니다.",
    "중학생이라면 알아야 할 영어 공부법이 있습니다.",
    "영어 내신, 만만치 않습니다. 제대로 준비하세요.",
    "중등 영어, 문법과 독해를 함께 잡아야 합니다.",
    "내신 1등급, 전략이 필요합니다.",
    "학교 영어 시험, 제대로 대비해야 합니다.",
    "중학교 영어가 어려운 이유가 있습니다.",
    "영어 시험은 특별한 대비가 필요합니다.",
    "독해 문제, 풀 수 있는 방법이 있습니다.",
    "영어는 혼자 공부하기 어려운 과목입니다.",
    "문법과 독해 실력을 균형 있게 키워야 합니다.",
]

# 아이보리 박스 표현 풀 (위치별)
IVORY_BOX_POOL_1 = [  # 진단
    "첫 수업에서 학생의 실력을 정밀 진단합니다. 개념 이해도, 계산 정확도, 문제 해결 속도를 파악하고 부족한 부분부터 채워갑니다.",
    "수업 시작 전, 학생이 어디서 막히는지 정확히 파악합니다. 무작정 진도를 나가지 않습니다.",
    "먼저 학생의 현재 실력을 꼼꼼히 체크합니다. 어떤 개념이 부족한지, 어디서 실수가 나는지 진단합니다.",
    "진도보다 진단이 먼저입니다. 학생이 무엇을 알고 무엇을 모르는지 정확히 파악한 후 수업을 시작합니다.",
    "첫 만남에서 실력을 정밀하게 측정합니다. 개념, 계산, 응용력을 종합 평가하여 맞춤 계획을 세웁니다.",
    "학생마다 약점이 다릅니다. 진단 테스트로 정확한 약점을 찾고, 그 부분을 집중 공략합니다.",
    "어디서부터 시작해야 할지 모르겠다고요? 진단 수업으로 정확한 출발점을 찾아드립니다.",
    "모든 수업은 진단에서 시작합니다. 학생의 현재 위치를 파악하고, 목표까지의 로드맵을 설계합니다.",
    "실력 진단 없이 수업하면 시간만 낭비됩니다. 체계적인 진단으로 효율적인 학습 경로를 설계합니다.",
    "학생의 학습 스타일과 약점을 분석합니다. 맞지 않는 방법으로 공부하면 성적이 안 오릅니다.",
    "첫 수업에서 학생의 사고 과정을 점검합니다. 문제를 푸는 방식을 보면 약점이 보입니다.",
    "성적표만 보지 않습니다. 실제로 문제를 풀어보면서 어디서 막히는지 정확히 파악합니다.",
    "실력은 숫자로만 평가할 수 없습니다. 개념 이해도, 문제 접근법, 시간 관리까지 종합 진단합니다.",
    "학생이 어떤 유형에서 자주 틀리는지 분석합니다. 약점을 알아야 보완할 수 있습니다.",
    "기초가 부족한지, 응용이 약한지, 시간 관리가 문제인지 정확히 진단합니다.",
    "첫 수업에서 학생과 충분히 대화합니다. 공부 습관, 목표를 파악합니다.",
    "진단 결과를 바탕으로 학생별 맞춤 커리큘럼을 설계합니다. 같은 수업은 없습니다.",
    "문제를 푸는 과정을 옆에서 지켜봅니다. 어떤 생각으로 접근하는지, 어디서 막히는지 확인합니다.",
    "학생의 이력을 꼼꼼히 살핍니다. 언제부터 어려워졌는지, 어떤 단원이 문제인지 파악합니다.",
    "정확한 진단이 빠른 성적 향상의 시작입니다. 시간을 들여 학생을 제대로 파악합니다.",
]

IVORY_BOX_POOL_2 = [  # 개념/전략
    "개념을 완벽히 이해한 후, 다양한 유형의 고난도 문제를 훈련합니다. 사고력을 기릅니다.",
    "개념 이해 없이 문제만 풀면 한계가 있습니다. 기본기를 탄탄히 합니다.",
    "문제를 많이 푸는 것보다 한 문제를 깊이 이해하는 게 중요합니다. 양보다 질입니다.",
    "공식만 알면 기본 문제는 풉니다. 하지만 심화 문제를 풀려면 개념을 이해해야 합니다.",
    "단계별 학습이 중요합니다. 앞 단원이 부족하면 뒷 단원을 이해할 수 없습니다.",
    "문제를 읽고 바로 풀지 않습니다. 무엇을 구하는지, 어떤 개념이 필요한지 먼저 생각합니다.",
    "풀이 과정을 깔끔하게 정리하는 연습을 합니다. 서술형 점수도 올리고, 실수도 줄입니다.",
    "비슷한 유형을 반복해서 풀며 패턴을 익힙니다. 새로운 문제도 익숙한 유형으로 변환할 수 있습니다.",
    "꾸준함이 핵심입니다. 한 번에 많이 하는 것보다 매일 조금씩 하는 게 효과적입니다.",
    "개념 설명 후 바로 문제를 풀어봅니다. 알았다고 생각해도 막상 풀면 막히는 경우가 많습니다.",
    "쉬운 문제부터 어려운 문제까지 단계별로 진행합니다. 갑자기 어려운 문제를 풀면 좌절감만 커집니다.",
    "문제를 풀다 막히면 힌트를 조금씩 줍니다. 스스로 깨달아야 기억에 남습니다.",
    "복습 시점을 알려드립니다. 오늘 배운 내용은 내일, 1주일 후, 1개월 후에 복습해야 합니다.",
    "문제 풀이 시간을 재면서 연습합니다. 실전에서는 시간이 촉박하기 때문입니다.",
    "모르는 문제는 5분만 고민합니다. 그래도 모르면 풀이를 보고 이해한 후 다시 풀어봅니다.",
    "개념 강의만 듣고 끝내지 않습니다. 반드시 직접 문제를 풀어봐야 합니다.",
    "손으로 푸는 과목입니다. 눈으로만 보면 안 됩니다. 직접 써가면서 풀어야 합니다.",
    "어려운 문제도 기본 개념의 조합입니다. 기본기가 탄탄하면 어떤 문제든 풀 수 있습니다.",
    "문제를 풀기 전에 그림을 그려봅니다. 시각화하면 이해가 쉬워집니다.",
    "틀린 문제를 다시 풀 때는 풀이를 보지 않고 도전합니다. 혼자 힘으로 풀어야 실력이 됩니다.",
]

IVORY_BOX_POOL_3 = [  # 기출 분석
    "학교의 기출문제를 철저히 분석합니다. 출제 선생님 스타일, 자주 나오는 유형을 파악합니다.",
    "기출문제만 풀어서는 안 됩니다. 출제 의도와 변형 가능성까지 분석하여 대비합니다.",
    "최근 3년 기출을 분석하여 출제 패턴을 파악합니다. 예상 문제까지 준비합니다.",
    "같은 학교 학생들을 여러 명 가르쳐본 경험이 있습니다. 그 학교 시험의 특징을 잘 압니다.",
    "학교별로 시험 난이도와 유형이 다릅니다. 맞춤 대비를 해드립니다.",
    "기출문제를 유형별로 정리하여 반복 훈련합니다. 비슷한 문제가 나오면 바로 풀 수 있습니다.",
    "학교 시험 범위에 맞춰 집중 대비합니다. 범위 외 내용으로 시간 낭비하지 않습니다.",
    "시험 2주 전부터는 기출과 예상 문제 위주로 수업합니다.",
    "같은 문제도 학교마다 변형해서 출제합니다. 학교 스타일의 변형 문제를 연습합니다.",
    "학교 시험은 교과서와 프린트에서 나옵니다. 꼼꼼하게 분석하여 출제 포인트를 짚어드립니다.",
    "시간 대비 문제 양이 많은 학교가 있습니다. 빠르게 푸는 연습도 함께 합니다.",
    "선생님이 강조한 부분, 수업 중 언급한 예시를 정리합니다. 시험에 나올 확률이 높습니다.",
    "학교 시험은 정보전입니다. 시험에 대한 정보를 바탕으로 효율적으로 대비합니다.",
    "서술형 비중이 높은 학교는 풀이 과정을 깔끔하게 쓰는 연습을 합니다.",
    "학교 프린트와 수업 필기도 함께 분석합니다. 시험에 나올 가능성이 높은 부분을 집중 대비합니다.",
    "출제 경향을 파악하고 있습니다. 그에 맞춰 준비합니다.",
    "내신 시험은 학교마다 다릅니다. 학교 특성에 맞춘 전략적 대비가 필요합니다.",
    "시험의 난이도 분포를 알고 있습니다. 어떤 문제에서 시간을 쓸지 전략을 세웁니다.",
    "혼자 준비하면 방향을 잃기 쉽습니다. 경험 있는 선생님과 함께 준비하세요.",
    "기출 분석으로 출제 경향과 자주 나오는 유형을 파악합니다.",
]

IVORY_BOX_POOL_4 = [  # 내신/수능 병행
    "학생의 입시 목표에 맞춰 내신과 수능 비중을 조절합니다. 수시 vs 정시에 따라 전략을 달리합니다.",
    "내신과 수능을 균형있게 대비합니다. 학기 중에는 내신 집중, 방학에는 수능 유형 훈련을 병행합니다.",
    "학년별로 내신과 수능 비중을 조절합니다. 고1은 내신 중심, 고3은 수능 비중을 높여갑니다.",
    "내신 기간에는 학교 시험에 집중하고, 그 외 기간에는 기초를 다집니다.",
    "수시를 노린다면 내신이 중요하고, 정시를 노린다면 수능이 중요합니다. 목표에 맞춰 비중을 조절합니다.",
    "내신 대비와 수능 대비, 따로 하면 시간이 2배로 듭니다. 효율적으로 병행하는 방법을 알려드립니다.",
    "내신 1등급이 수능 1등급으로 이어지도록 합니다. 따로 공부하지 않아도 됩니다.",
    "입시 전략에 맞춰 내신과 수능 비중을 설계합니다. 학생마다 최적의 밸런스가 다릅니다.",
    "고등학교 3년, 내신과 수능을 어떻게 배분할지 로드맵을 세워드립니다.",
    "내신 기간에는 기출 중심으로, 수능 시즌에는 평가원 기출 중심으로 진행합니다.",
    "내신도 중요하고 수능도 중요합니다. 둘 다 놓치지 않는 학습 계획을 함께 세웁니다.",
    "1, 2학년은 내신에 집중하면서 기초를 쌓고, 3학년은 본격적으로 수능 대비에 들어갑니다.",
    "시험 3주 전부터는 내신에 올인합니다. 그 외 기간에는 실력을 키웁니다.",
    "내신과 수능, 어느 하나도 소홀히 하지 않습니다. 효율적인 병행 전략을 알려드립니다.",
    "수시와 정시, 어느 쪽에 무게를 둘지에 따라 전략이 달라집니다. 상담을 통해 방향을 정합니다.",
    "내신 시험이 끝나면 바로 수능 대비로 전환합니다. 시간 낭비 없이 효율적으로 운영합니다.",
    "내신 공부가 수능에 도움이 되도록 합니다. 두 번 공부하는 비효율을 없앱니다.",
    "내신 범위가 곧 수능 출제 범위입니다. 한 번 공부로 두 가지를 대비합니다.",
    "내신과 수능의 차이를 명확히 알려드립니다. 두 가지를 효율적으로 병행할 수 있는 학습 전략을 세웁니다.",
    "내신은 학교별로 대비하고, 수능은 전국 기준으로 준비합니다. 두 마리 토끼를 다 잡는 전략이 있습니다.",
]

# 마무리 표현 풀 (30개)
ENDING_POOL = [
    "지금 시작하세요. 늦었다고 생각할 때가 가장 빠른 때입니다.",
    "혼자 고민하지 마세요. 함께하면 달라집니다.",
    "더 늦기 전에 시작하세요. 여러분도 잘하는 학생이 될 수 있습니다.",
    "결심이 시작입니다. 오늘 상담받고, 내일부터 달라지세요.",
    "변화는 결심에서 시작됩니다. 지금 연락 주세요.",
    "지금 바로 잡으세요. 첫 상담은 무료입니다.",
    "맞춤 과외, 지금 시작하세요.",
    "성적이 고민이라면, 지금 바로 상담받아 보세요.",
    "오늘이 가장 빠른 날입니다. 지금 시작하세요.",
    "실력 향상을 응원합니다.",
    "포기가 아니라 도전입니다. 함께 해보세요.",
    "자신감, 되찾을 수 있습니다. 포기하지 마세요.",
    "1등급도, 성적 향상도 가능합니다. 믿고 시작해 보세요.",
    "힘들 때 도움받으면 됩니다.",
    "어렵다고 포기하면 안 됩니다. 방법을 바꿔보세요.",
    "지금의 노력이 대학을 결정합니다. 함께 준비해요.",
    "실력, 키울 수 있습니다. 포기하기엔 아직 이릅니다.",
    "어렵다고 피하면 계속 어렵습니다. 지금 시작하세요.",
    "내신과 수능, 두 마리 토끼를 다 잡는 방법이 있습니다.",
    "체계적인 1:1 수업으로 내신을 완벽 대비하세요.",
    "맞춤 과외, 상담부터 시작하세요.",
    "전문 선생님과 함께하세요.",
    "전략입니다. 제대로 된 전략으로 성적을 올려보세요.",
    "검증된 과외, 지금 문의하세요.",
    "효율적으로 병행하는 방법을 알려드립니다.",
    "맞춤 수업, 지금 상담받으세요.",
    "성적 향상의 시작, 무료 상담으로 첫걸음을 떼세요.",
    "내신에 특화된 과외, 지금 시작할 때입니다.",
    "시작이 반입니다. 지금 연락 주세요.",
    "체계적인 관리로 성적 향상을 경험하세요.",
]


def get_content_type(filename):
    """파일명에서 콘텐츠 유형 파악"""
    if 'high-math' in filename:
        return 'high_math'
    elif 'high-english' in filename:
        return 'high_english'
    elif 'middle-math' in filename:
        return 'middle_math'
    elif 'middle-english' in filename:
        return 'middle_english'
    return 'unknown'


def rewrite_file(filepath, pool_index):
    """파일을 표현 풀을 사용하여 리라이팅"""
    try:
        with open(filepath, 'r', encoding='utf-8') as f:
            content = f.read()
    except:
        return False, "읽기 실패"

    filename = os.path.basename(filepath)
    content_type = get_content_type(filename)

    if content_type == 'unknown':
        return False, "알 수 없는 유형"

    # YAML과 본문 분리
    parts = content.split('---', 2)
    if len(parts) < 3:
        return False, "YAML 파싱 실패"

    yaml_content = parts[1]
    body_content = parts[2]

    # 지역 정보 추출
    city_match = re.search(r'cities:\s*\n\s*-\s*(\S+)', yaml_content)
    city = city_match.group(1) if city_match else ""

    # 표현 풀 인덱스 계산 (다양하게 분산)
    idx1 = pool_index % 30
    idx2 = (pool_index + 7) % 20
    idx3 = (pool_index + 13) % 20
    idx4 = (pool_index + 19) % 20
    idx5 = (pool_index + 3) % 30

    # 서두 선택
    if content_type == 'high_math':
        intro = INTRO_POOL[idx1]
    elif content_type == 'high_english':
        intro = ENGLISH_INTRO_POOL[idx1]
    elif content_type == 'middle_math':
        intro = MIDDLE_MATH_INTRO_POOL[idx1]
    else:  # middle_english
        intro = MIDDLE_ENGLISH_INTRO_POOL[idx1]

    # 아이보리 박스 선택
    box1 = IVORY_BOX_POOL_1[idx2]
    box2 = IVORY_BOX_POOL_2[idx3]
    box3 = IVORY_BOX_POOL_3[idx4]
    box4 = IVORY_BOX_POOL_4[(pool_index + 11) % 20]

    # 마무리 선택
    ending = ENDING_POOL[idx5]

    # 본문 내 아이보리 박스 교체
    box_pattern = r'(<div style="background-color: #FDF8F0[^>]*>\s*<strong>이렇게 수업합니다!</strong><br>\s*)([^<]+)(</div>)'

    boxes_found = re.findall(box_pattern, body_content)
    if len(boxes_found) >= 1:
        # 첫 번째 박스 교체
        body_content = re.sub(
            box_pattern,
            lambda m, c=0: f'{m.group(1)}{box1}\n{m.group(3)}' if c == 0 else m.group(0),
            body_content,
            count=1
        )

    # 순차적으로 박스 교체
    box_replacements = [box1, box2, box3, box4]
    box_idx = [0]

    def replace_box(m):
        if box_idx[0] < len(box_replacements):
            replacement = box_replacements[box_idx[0]]
            box_idx[0] += 1
            return f'{m.group(1)}{replacement}\n{m.group(3)}'
        return m.group(0)

    body_content = re.sub(box_pattern, replace_box, body_content)

    # 서두 교체 (YAML 직후 첫 문단)
    first_para_match = re.match(r'(\s*\n)([^\n<#]+\n)', body_content)
    if first_para_match:
        body_content = f'\n{intro}\n' + body_content[first_para_match.end():]

    # 마무리 교체
    ending_pattern = r'(## 마무리\s*\n+)([^\n]+)'
    if re.search(ending_pattern, body_content):
        # 지역명 포함된 마무리로 교체
        city_ending = f"{city} 학생 여러분, {ending}"
        body_content = re.sub(ending_pattern, f'\\g<1>{city_ending}', body_content)

    # 최종 콘텐츠 조합
    new_content = f'---{yaml_content}---{body_content}'

    # 파일 쓰기
    try:
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(new_content)
        return True, "성공"
    except:
        return False, "쓰기 실패"


def main():
    # 경기도 파일 목록 가져오기
    base_path = '/home/user/edu-guide/content/gyeonggi'
    files = []

    for root, dirs, filenames in os.walk(base_path):
        for filename in filenames:
            if filename.endswith('.md') and not filename.startswith('_'):
                filepath = os.path.join(root, filename)
                files.append(filepath)

    print(f"총 {len(files)}개 파일 발견")

    success_count = 0
    fail_count = 0

    for idx, filepath in enumerate(files):
        success, msg = rewrite_file(filepath, idx)
        if success:
            success_count += 1
            if (idx + 1) % 50 == 0:
                print(f"진행: {idx + 1}/{len(files)}")
        else:
            fail_count += 1
            print(f"실패: {filepath} - {msg}")

    print(f"\n완료: 성공 {success_count}, 실패 {fail_count}")


if __name__ == '__main__':
    main()
