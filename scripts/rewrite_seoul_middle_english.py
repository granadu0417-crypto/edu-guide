#!/usr/bin/env python3
"""서울 중등 영어 콘텐츠 리라이팅 스크립트"""

import os
import re
import glob

# 표현 풀 - 서두 (30개)
INTRO_POOL = [
    "중학교 영어, 갑자기 어려워졌나요? 문법이 본격적으로 시작되면서 많은 학생들이 어려움을 느낍니다.",
    "영어 성적이 떨어지고 있다면, 지금이 잡아야 할 때입니다.",
    "중학교 영어, 어디서부터 손을 대야 할지 모르겠다면 도움을 받으세요.",
    "영어 때문에 스트레스받는 아이, 방법을 바꿔야 합니다.",
    "초등학교 때 잘했는데 중학교 영어가 안 된다면, 문법 기초가 흔들린 겁니다.",
    "영어 실력, 지금 잡지 않으면 고등학교 가서 더 힘들어요.",
    "우리 아이 영어, 왜 점수가 안 나올까요?",
    "중학 영어의 벽, 함께 넘어봅시다.",
    "영어 자신감을 되찾을 수 있습니다. 체계적으로 시작하세요.",
    "중학교 영어, 문법만 잡으면 독해가 됩니다.",
    "영어 포기하기엔 너무 이릅니다. 방법이 있어요.",
    "내 아이 영어 실력, 지금 어디쯤일까요?",
    "영어 때문에 고민이라면, 혼자 끙끙대지 마세요.",
    "중학교 영어, 체계적으로 잡으면 고등학교도 문제없습니다.",
    "영어가 어려운 게 아니라, 배우는 순서가 잘못된 거예요.",
    "중학교 영어 성적, 충분히 올릴 수 있습니다.",
    "문법 기초가 탄탄해야 독해가 됩니다.",
    "우리 아이에게 맞는 영어 공부법을 찾아드립니다.",
    "영어 점수 올리고 싶으시죠? 방법이 있습니다.",
    "중학 영어, 지금 놓치면 고등학교 때 두 배로 힘들어요.",
    "영어를 싫어하는 아이도 재미있게 배울 수 있어요.",
    "문법을 알면 영어가 쉬워집니다.",
    "중학교 영어, 막막하다면 전문가와 함께하세요.",
    "영어 실력은 하루아침에 생기지 않습니다. 꾸준함이 답입니다.",
    "내신 영어, 지금부터 준비하면 충분합니다.",
    "영어 공부, 효율적으로 하는 방법을 알려드립니다.",
    "중학생 영어, 어떻게 해야 잘할 수 있을까요?",
    "영어가 재미없다면, 배우는 방식을 바꿔야 합니다.",
    "중학교 영어, 기초부터 탄탄히 쌓아보세요.",
    "영어 성적 향상의 비결, 알려드립니다."
]

# 아이보리 박스 내용 풀 (위치별)
IVORY_BOX_POOL = {
    "진단": [
        "첫 수업에서 문법, 독해, 어휘력을 종합적으로 진단합니다. 어디가 부족한지 파악하고 맞춤 학습을 시작합니다.",
        "수업 전 레벨 테스트로 현재 실력을 파악합니다. 무작정 진도를 나가지 않습니다.",
        "영어의 어느 부분이 약한지 먼저 알아야 합니다. 진단 후 맞춤 수업을 설계합니다.",
        "학생마다 영어가 안 되는 이유가 다릅니다. 정확한 진단이 먼저입니다.",
        "첫 시간에 문법 이해도와 독해력을 확인합니다. 이를 바탕으로 수업 방향을 정합니다.",
        "무엇을 알고 무엇을 모르는지 파악하는 것이 시작입니다.",
        "테스트로 현재 위치를 확인하고, 목표까지의 학습 계획을 세웁니다.",
        "학생의 영어 습관과 실력을 함께 분석합니다. 효과적인 학습법을 찾아드립니다.",
        "진도보다 진단이 우선입니다. 학생 상태를 정확히 파악한 후 시작합니다.",
        "처음 만나면 강점과 약점을 파악합니다. 이를 바탕으로 맞춤 전략을 세웁니다."
    ],
    "문법": [
        "문법을 이해해야 독해가 됩니다. 암기가 아닌 이해 중심으로 가르칩니다.",
        "왜 그런 문법 규칙이 있는지 이해하면 영어가 쉬워집니다.",
        "문법 규칙만 외우면 금방 까먹습니다. 원리를 이해하면 적용이 됩니다.",
        "문법 설명을 쉽게 풀어서 합니다. 이해가 되어야 문장에 적용할 수 있습니다.",
        "영어 문법은 체계가 있습니다. 순서대로 차근차근 쌓아갑니다.",
        "어려운 문법도 쉽게 설명합니다. 학생이 이해할 때까지 반복합니다.",
        "문법 이해 없이 문장만 외우면 한계가 있습니다. 기본기를 탄탄히 합니다.",
        "문법이 왜 그런지 설명할 수 있어야 진짜 이해한 겁니다.",
        "문법을 예문과 함께 설명합니다. 실제로 어떻게 쓰이는지 보여드립니다.",
        "영어 문법을 한국어와 비교해서 설명합니다. 이해하기 쉽도록."
    ],
    "독해": [
        "독해는 문장 구조를 파악하는 것부터 시작합니다. 끊어 읽기 연습을 합니다.",
        "긴 문장도 구조를 알면 해석이 됩니다. 문장 분석법을 가르칩니다.",
        "모르는 단어가 있어도 문맥으로 추측하는 법을 배웁니다.",
        "독해는 기술입니다. 연습하면 빨라지고 정확해집니다.",
        "지문을 읽고 핵심을 파악하는 연습을 합니다. 내신과 수능 모두 대비됩니다.",
        "영어 독해의 기본은 문장 구조 파악입니다. 기초부터 가르칩니다.",
        "속독과 정독을 균형 있게 연습합니다. 상황에 맞게 읽는 법을 배웁니다.",
        "독해 지문의 유형별 접근법을 가르칩니다. 어떤 지문이든 읽을 수 있도록.",
        "문장을 끊어 읽고 연결하는 연습을 합니다. 긴 문장도 두렵지 않게.",
        "독해력 향상은 꾸준한 연습이 답입니다. 매 수업 독해 훈련을 합니다."
    ],
    "내신": [
        "학교별 출제 경향을 분석합니다. 기출문제를 바탕으로 철저히 대비합니다.",
        "내신 시험 범위에 맞춰 집중 학습합니다. 빈출 유형을 확실히 잡습니다.",
        "서술형 평가 대비도 합니다. 영작 연습과 문법 적용 훈련을 합니다.",
        "학교 교과서를 완벽 분석합니다. 시험에 나올 포인트를 잡아드립니다.",
        "내신 2주 전부터 집중 대비에 들어갑니다. 체계적으로 복습합니다.",
        "기출문제로 예상 문제를 뽑습니다. 실전 감각을 키웁니다.",
        "내신은 교과서가 답입니다. 본문 완벽 이해를 목표로 합니다.",
        "학교 선생님의 출제 스타일을 파악합니다. 맞춤 대비가 가능합니다.",
        "내신 기간에는 오로지 시험 범위에 집중합니다. 효율적으로 공부합니다.",
        "시험 직전 최종 점검을 합니다. 빈틈없이 준비합니다."
    ],
    "학년별": [
        "학년에 맞는 난이도로 수업합니다. 현재 수준에서 한 걸음씩 나아갑니다.",
        "학년별 중요 문법을 집중 공략합니다. 핵심을 놓치지 않습니다.",
        "학년이 올라갈수록 어려워집니다. 미리 대비해야 따라갈 수 있습니다.",
        "학년별 학습 로드맵을 제시합니다. 언제 무엇을 해야 할지 알려드립니다.",
        "현재 학년에 충실하면서 다음 학년을 준비합니다. 균형 잡힌 학습을 합니다.",
        "중1부터 중3까지 연결되는 문법을 체계적으로 정리합니다.",
        "학년이 바뀔 때 놓치기 쉬운 부분을 짚어드립니다.",
        "지금 학년에서 확실히 잡아야 나중이 편합니다. 기초를 단단히.",
        "학년별 필수 문법 체크리스트로 빈틈을 확인합니다.",
        "선행보다 현행이 우선입니다. 지금 배우는 것을 완벽히 합니다."
    ],
    "수업료": [
        "학생 상황에 맞춰 수업 횟수를 조절합니다. 상담 후 결정하세요.",
        "수업료는 수업 횟수와 시간에 따라 달라집니다. 자세한 내용은 상담 시 안내드립니다.",
        "효과적인 학습을 위한 적절한 수업 횟수를 권장합니다.",
        "학생의 목표와 현재 실력에 따라 최적의 수업 계획을 세웁니다.",
        "무료 상담으로 수업 방향과 비용을 안내받으세요.",
        "학습 효과를 높이는 수업 횟수를 함께 정합니다.",
        "상담에서 학생에게 맞는 수업 계획을 제안드립니다.",
        "학생별 맞춤 수업 계획을 세우고 비용을 안내합니다.",
        "수업료는 학생의 상황과 목표에 따라 유연하게 조정 가능합니다.",
        "최적의 학습 효과를 위한 수업 설계를 도와드립니다."
    ]
}

# 섹션 제목 풀
SECTION_TITLES = {
    "중학영어특징": [
        "중학교 영어가 어려운 이유",
        "중학교 영어, 무엇이 달라졌나요?",
        "초등학교와 다른 중학 영어",
        "중학교 영어가 어렵게 느껴지는 이유",
        "왜 갑자기 영어가 안 될까요?",
        "중학 영어의 특징",
        "중학교 영어, 이렇게 달라집니다",
        "영어가 어려워지는 시기",
        "중학교 영어의 벽",
        "중학 영어, 무엇이 문제일까요?",
        "중학교 영어 난이도의 비밀",
        "왜 영어 성적이 떨어질까요?",
        "중학교 영어의 진짜 어려움",
        "영어가 싫어지는 이유",
        "중학교 영어, 어디서 막히나요?"
    ],
    "학교특징": [
        "지역 학교별 영어 시험 특징",
        "내신 시험의 특징",
        "학교별 영어 출제 경향",
        "학교 시험, 이렇게 나옵니다",
        "내신 영어 시험 분석",
        "학교별 시험 난이도",
        "영어 내신, 어떻게 출제되나요?",
        "학교 시험의 특징과 대비법",
        "내신 시험 경향 분석",
        "학교별 출제 패턴",
        "영어 시험 출제 경향",
        "내신 대비 포인트",
        "학교 시험 준비 전략",
        "내신 영어의 핵심",
        "시험 출제 경향과 대비"
    ],
    "과외필요성": [
        "1:1 과외가 필요한 이유",
        "개인 맞춤 수업의 효과",
        "과외 수업의 장점",
        "왜 1:1 수업이 효과적일까요?",
        "맞춤 지도의 힘",
        "과외로 달라지는 것들",
        "1:1 수업, 무엇이 다를까요?",
        "과외의 효과",
        "맞춤 수업이 필요한 이유",
        "개인 지도의 장점",
        "1:1 과외의 효과",
        "과외 수업, 어떻게 다른가요?",
        "맞춤 학습의 힘",
        "왜 과외를 선택하나요?",
        "1:1 수업의 장점"
    ],
    "학년별전략": [
        "학년별 영어 학습 전략",
        "학년에 따른 학습법",
        "학년별 영어 공부법",
        "중1·중2·중3 학습 전략",
        "학년별 맞춤 학습",
        "학년에 맞는 영어 공부",
        "학년별 중점 사항",
        "학년별 학습 포인트",
        "학년에 따른 공부 전략",
        "중학교 학년별 영어 학습",
        "학년별 영어 로드맵",
        "학년별 학습 가이드",
        "학년에 맞는 학습법",
        "중1-중3 학습 전략",
        "학년별 공부 방향"
    ]
}

# FAQ 풀
FAQ_POOL = [
    {
        "q": "영어 기초가 부족한데 따라갈 수 있을까요?",
        "a": "학생 수준에 맞춰 시작합니다. 부족한 기초부터 차근차근 채워나갑니다."
    },
    {
        "q": "문법이 너무 어려워요.",
        "a": "문법은 이해가 먼저입니다. 쉽게 풀어서 설명하고, 예문으로 연습합니다."
    },
    {
        "q": "단어를 외워도 금방 까먹어요.",
        "a": "문맥 속에서 단어를 익히면 오래 기억됩니다. 효과적인 암기법을 알려드립니다."
    },
    {
        "q": "수업은 어떤 방식으로 진행되나요?",
        "a": "문법 설명, 독해 연습, 어휘 학습 순서로 진행됩니다. 학생에 맞게 조정합니다."
    },
    {
        "q": "얼마나 해야 성적이 오르나요?",
        "a": "보통 2-3개월이면 변화가 보입니다. 꾸준히 하면 확실히 오릅니다."
    },
    {
        "q": "과외 선생님은 어떤 분인가요?",
        "a": "검증된 실력의 대학생이나 전문 강사입니다. 학생과의 소통을 중시하는 분들입니다."
    },
    {
        "q": "숙제가 많이 나오나요?",
        "a": "학생 상황에 맞게 적절히 부여합니다. 무리하지 않게 조절합니다."
    },
    {
        "q": "온라인 수업도 가능한가요?",
        "a": "가능합니다. 대면과 비슷한 효과를 냅니다."
    },
    {
        "q": "독해가 너무 느려요.",
        "a": "문장 구조 파악 연습을 하면 빨라집니다. 끊어 읽기 훈련이 도움됩니다."
    },
    {
        "q": "방학 때 수업은 어떻게 하나요?",
        "a": "방학에는 부족한 부분 보충이나 선행에 집중합니다. 횟수 조정도 가능합니다."
    }
]

# 마무리 풀
CLOSING_POOL = [
    "중학생 영어, 지금 시작하면 충분히 따라갈 수 있습니다. 함께 해요.",
    "영어 실력은 노력하면 반드시 오릅니다. 시작이 반입니다.",
    "중학교 영어, 혼자 고민하지 마세요. 도움받으면 달라집니다.",
    "영어 자신감을 되찾을 수 있습니다. 지금 상담받아보세요.",
    "내 아이 영어, 체계적으로 관리해보세요. 결과가 달라집니다.",
    "중학 영어의 기초를 탄탄히 쌓으면 고등학교도 문제없습니다.",
    "영어 때문에 스트레스 받지 마세요. 해결책이 있습니다.",
    "꾸준함이 영어 실력의 비결입니다. 함께 시작해요.",
    "영어 성적 향상, 생각보다 어렵지 않습니다.",
    "지금 시작하면 됩니다. 중학생 영어, 도와드릴게요.",
    "영어를 잘하는 방법, 알려드립니다.",
    "중학교 영어, 기초부터 탄탄히 쌓아보세요.",
    "내신 영어, 제대로 준비하면 좋은 결과가 있습니다.",
    "영어 공부, 방법을 알면 재미있어집니다.",
    "중학생 영어 실력, 지금 잡아야 합니다.",
    "영어 성적 올리고 싶다면 지금 연락주세요.",
    "중학교 영어, 함께하면 어렵지 않습니다.",
    "영어 기초, 지금 잡으면 나중이 편합니다.",
    "내 아이 영어 실력, 키워드릴게요.",
    "영어 고민, 상담으로 해결하세요.",
    "중학생 영어, 맞춤 지도로 달라집니다.",
    "영어 실력 향상의 시작점, 여기입니다.",
    "지금 시작해서 영어 자신감을 키우세요.",
    "중학교 영어, 체계적으로 잡아드립니다.",
    "영어 성적, 함께 올려봅시다.",
    "내신 영어 걱정, 이제 그만하세요.",
    "중학생 영어, 전문가와 함께하세요.",
    "영어 때문에 고민이라면 연락주세요.",
    "중학교 영어의 기초, 확실히 잡아드립니다.",
    "영어 실력, 지금부터 키워보세요."
]


def extract_info_from_file(filepath):
    """파일에서 지역 및 학교 정보 추출"""
    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()

    # 구 이름 추출
    gu_match = re.search(r'cities:\s*\n\s*-\s*(\S+)', content)
    gu = gu_match.group(1) if gu_match else ""

    # 동 이름 추출 (title에서)
    title_match = re.search(r'title:\s*["\']?(\S+구)\s+(\S+)\s+(중등|중학)', content)
    if title_match:
        dong = title_match.group(2)
    else:
        # 파일명에서 추출
        filename = os.path.basename(filepath)
        dong_match = re.match(r'([a-z0-9]+)-middle', filename)
        dong = dong_match.group(1) if dong_match else ""

    # 학교 이름 추출
    school_match = re.search(r'title:\s*[^-]+-\s*([^"\']+)', content)
    if school_match:
        schools = school_match.group(1).strip()
    else:
        schools = ""

    return {
        "gu": gu,
        "dong": dong,
        "schools": schools,
        "original_content": content
    }


def generate_content(info, pool_index):
    """표현 풀을 사용해 새 콘텐츠 생성"""
    gu = info["gu"]
    dong = info["dong"]
    schools = info["schools"]
    original = info["original_content"]

    # YAML 프론트매터 추출
    yaml_match = re.match(r'(---\n.*?\n---)\n', original, re.DOTALL)
    if not yaml_match:
        return None
    yaml_part = yaml_match.group(1)

    # 인덱스 기반 선택 (영어는 다른 오프셋 사용)
    idx = (pool_index + 5) % 30
    idx2 = (pool_index + 9) % 15
    idx3 = (pool_index + 1) % 10
    idx4 = (pool_index + 13) % 10

    intro = INTRO_POOL[idx]
    section1 = SECTION_TITLES["중학영어특징"][idx2]
    section2 = SECTION_TITLES["학교특징"][(idx2 + 5) % 15]
    section3 = SECTION_TITLES["과외필요성"][(idx2 + 9) % 15]
    section4 = SECTION_TITLES["학년별전략"][(idx2 + 13) % 15]

    box1 = IVORY_BOX_POOL["진단"][idx3]
    box2 = IVORY_BOX_POOL["문법"][(idx3 + 3) % 10]
    box3 = IVORY_BOX_POOL["독해"][(idx3 + 5) % 10]
    box4 = IVORY_BOX_POOL["내신"][(idx3 + 7) % 10]
    box5 = IVORY_BOX_POOL["학년별"][(idx3 + 9) % 10]
    box6 = IVORY_BOX_POOL["수업료"][idx4]

    # FAQ 선택 (5개)
    faq_indices = [(idx + i*2) % len(FAQ_POOL) for i in range(5)]
    selected_faqs = [FAQ_POOL[i] for i in faq_indices]

    closing = CLOSING_POOL[idx]

    # 학교 정보 문장 생성
    school_intro = ""
    if schools:
        school_intro = f"{schools} 학생들이 내신 경쟁을 하며 공부하고 있습니다."

    # 콘텐츠 생성
    content = f"""{yaml_part}

## {gu} {dong} 중학생, 영어가 어렵다면

{intro}

<div style="background-color: #FDF8F0; border-left: 3px solid #d4a574; padding: 18px; margin: 15px 0; font-size: 0.95em;">
<strong>이렇게 수업합니다!</strong><br>
{box1}
</div>

## {section1}

중학교 영어는 초등학교와 달리 본격적인 문법이 시작됩니다. 시제, 조동사, 관계대명사 등 복잡한 문법이 등장합니다. 문법 없이는 독해가 안 되고, 영작은 더더욱 어렵습니다.

단어만 알아도 되던 시절이 끝났습니다. 문장 구조를 이해하고, 문법 규칙을 적용해야 합니다. 이 단계에서 문법 기초가 흔들리면 고등학교 영어가 매우 어려워집니다.

<div style="background-color: #FDF8F0; border-left: 3px solid #d4a574; padding: 18px; margin: 15px 0; font-size: 0.95em;">
<strong>이렇게 수업합니다!</strong><br>
{box2}
</div>

## {section2}

{gu}의 중학교들은 영어 내신 경쟁이 치열합니다. 교과서 본문 암기는 기본이고, 문법 응용 문제와 서술형까지 대비해야 합니다.

{school_intro} 학교별 출제 경향을 파악하고 대비하는 것이 중요합니다. 기출문제 분석을 통해 어떤 유형이 자주 나오는지 확인합니다.

<div style="background-color: #FDF8F0; border-left: 3px solid #d4a574; padding: 18px; margin: 15px 0; font-size: 0.95em;">
<strong>이렇게 수업합니다!</strong><br>
{box3}
</div>

## {section3}

학원에서는 여러 학생을 함께 가르치기 때문에 개인별 맞춤 지도가 어렵습니다. 모르는 부분이 있어도 질문하기 어렵고, 진도에 맞춰 넘어가야 합니다.

1:1 과외는 학생 수준에 맞춰 수업합니다. 모르는 문법은 확실히 짚고 넘어갑니다. 약한 부분은 더 시간을 들이고, 잘하는 부분은 빠르게 넘어갑니다.

<div style="background-color: #FDF8F0; border-left: 3px solid #d4a574; padding: 18px; margin: 15px 0; font-size: 0.95em;">
<strong>이렇게 수업합니다!</strong><br>
{box4}
</div>

## {section4}

### 중1 영어

중1은 영어 문법의 기초를 다지는 시기입니다. be동사, 일반동사, 시제의 기본을 배웁니다. 이 단계에서 문법 개념이 흔들리면 중2, 중3에서 어려워집니다.

### 중2 영어

중2는 문법 난이도가 확 올라가는 시기입니다. 부정사, 동명사, 비교급, 접속사 등 중요한 문법이 많습니다. 독해 지문도 길어지고 복잡해집니다.

### 중3 영어

중3은 고등학교를 준비하는 시기입니다. 관계대명사, 분사, 가정법 등 고급 문법을 배웁니다. 수능 유형의 독해 지문도 접하기 시작합니다.

<div style="background-color: #FDF8F0; border-left: 3px solid #d4a574; padding: 18px; margin: 15px 0; font-size: 0.95em;">
<strong>이렇게 수업합니다!</strong><br>
{box5}
</div>

## 수업료 안내

**중학생**은 주1회 22만원 - 32만원, 주2회 29만원 - 47만원 선입니다.

<div style="background-color: #FDF8F0; border-left: 3px solid #d4a574; padding: 18px; margin: 15px 0; font-size: 0.95em;">
<strong>이렇게 수업합니다!</strong><br>
{box6}
</div>

{{{{< cta-dual type="final" >}}}}

## 자주 묻는 질문

"""

    # FAQ 추가
    for faq in selected_faqs:
        content += f"""**Q. {faq['q']}**

{faq['a']}

"""

    # 마무리
    content += f"""## 마무리

{gu} {dong} 중학생 여러분, {closing}
"""

    return content


def rewrite_files():
    """서울 중등 영어 파일 리라이팅"""
    base_path = "/home/user/edu-guide/content/seoul"

    # 모든 중등 영어 파일 찾기
    files = glob.glob(f"{base_path}/**/*-middle-english.md", recursive=True)

    print(f"총 {len(files)}개 파일 발견")

    success_count = 0
    fail_count = 0

    for i, filepath in enumerate(files):
        try:
            info = extract_info_from_file(filepath)

            if not info["gu"]:
                print(f"건너뜀 (정보 추출 실패): {filepath}")
                fail_count += 1
                continue

            new_content = generate_content(info, i)

            if new_content:
                with open(filepath, 'w', encoding='utf-8') as f:
                    f.write(new_content)
                success_count += 1
                if success_count % 50 == 0:
                    print(f"진행: {success_count}/{len(files)}")
            else:
                fail_count += 1

        except Exception as e:
            print(f"오류: {filepath} - {e}")
            fail_count += 1

    print(f"\n서울 중등 영어 리라이팅 완료!")
    print(f"성공: {success_count}개, 실패: {fail_count}개")


if __name__ == "__main__":
    rewrite_files()
