#!/usr/bin/env python3
"""
경기도 미발행 5개 도시 콘텐츠 생성 스크립트 v5
- 200~400줄 분포 확실히 적용
- 목표 줄수에 따라 다른 템플릿 사용
"""

import os
import random
from datetime import datetime

BASE_PATH = "/home/user/edu-guide/content/gyeonggi"

CITIES = {
    "anseong": {"name_ko": "안성시", "dongs": ["안성1동", "안성2동", "안성3동", "공도읍", "미양면", "대덕면", "금광면", "서운면", "보개면", "양성면"]},
    "bundang": {"name_ko": "분당", "dongs": ["분당동", "수내동", "정자동", "서현동", "야탑동", "이매동", "금곡동", "구미동", "판교동", "운중동"]},
    "gwangju_gg": {"name_ko": "광주시", "dongs": ["경안동", "송정동", "광남동", "목동", "오포읍", "초월읍", "실촌읍", "도척면", "퇴촌면", "남종면"]},
    "ilsan": {"name_ko": "일산", "dongs": ["주엽동", "정발산동", "마두동", "장항동", "백석동", "대화동", "일산동", "풍동", "탄현동", "식사동"]},
    "pyeongchon": {"name_ko": "평촌", "dongs": ["비산동", "평촌동", "귀인동", "부흥동", "호계동", "범계동", "관양동", "달안동", "신촌동", "평안동"]}
}

LINE_DISTRIBUTION = [(200, 250, 0.25), (251, 300, 0.35), (301, 350, 0.25), (351, 400, 0.15)]

def get_target_range():
    """목표 줄수 범위 반환 (short/medium/long/extra_long)"""
    r = random.random()
    if r < 0.25:
        return "short"  # 200-250줄
    elif r < 0.60:
        return "medium"  # 251-300줄
    elif r < 0.85:
        return "long"  # 301-350줄
    else:
        return "extra_long"  # 351-400줄

IMAGES = [
    "photo-1503676260728-1c00da094a0b", "photo-1522202176988-66273c2fd55f",
    "photo-1523240795612-9a054b0db644", "photo-1517842645767-c639042777db",
    "photo-1513258496099-48168024aec0", "photo-1427504494785-3a9ca7044f45",
    "photo-1571260899304-425eee4c7efc", "photo-1519406596751-0a3ccc4937fe",
    "photo-1524178232363-1fb2b075b655", "photo-1509062522246-3755977927d7",
]

def make_ivory_box(text):
    return f'''<div style="background-color: #FDF8F0; border-left: 3px solid #d4a574; padding: 18px; margin: 15px 0; font-size: 0.95em;">
<strong>이렇게 수업합니다!</strong><br>
{text}
</div>'''

def generate_content(city_name_ko, dong_name, subject, level, size, index):
    is_math = subject == "math"
    level_ko = "고등" if level == "high" else "중등"
    subject_ko = "수학" if is_math else "영어"
    image = IMAGES[index % len(IMAGES)]

    if level == "high":
        cost_main = "주1회 25만원 - 36만원, 주2회 33만원 - 53만원"
    else:
        cost_main = "주1회 22만원 - 32만원, 주2회 29만원 - 47만원"

    # 아이보리 박스 텍스트 풀
    ivory_pool = [
        "첫 수업에서 학생의 현재 실력을 정확하게 진단합니다. 어디서 막히는지 파악한 후 맞춤 계획을 세웁니다. 무작정 진도를 나가지 않습니다.",
        "개념 설명 후 바로 문제 풀이로 연결합니다. 이해했는지 즉시 확인하고 넘어갑니다. 애매하게 넘어가지 않습니다.",
        "오답 노트를 함께 만들어갑니다. 틀린 문제는 반드시 다시 풀어봅니다. 왜 틀렸는지 분석합니다.",
        "학교 시험 2주 전부터 집중 대비합니다. 기출문제 분석과 예상문제 풀이를 진행합니다. 실전처럼 연습합니다.",
        "매 수업 시작 전 지난 내용을 복습합니다. 까먹기 전에 다시 한번 확인합니다. 복습이 실력입니다.",
        "어려운 문제는 단계별로 접근합니다. 한 번에 이해되지 않아도 괜찮습니다. 천천히 같이 갑니다.",
        "숙제는 적정량만 내드립니다. 무리하지 않으면서도 실력이 오르도록 합니다. 양보다 질입니다.",
        "학부모님께 주기적으로 학습 상황을 보고드립니다. 함께 아이를 케어합니다. 가정과 연계합니다.",
        "학생이 이해했는지 직접 설명해보게 합니다. 설명할 수 있어야 진짜 아는 겁니다.",
        "시험 후에는 함께 오답을 분석합니다. 왜 틀렸는지 파악하고 다음에 같은 실수를 안 하도록 합니다.",
        "모르는 건 바로 질문하게 합니다. 질문을 두려워하지 않도록 분위기를 만들어줍니다.",
        "학생의 컨디션도 체크합니다. 공부만 잘한다고 되는 게 아닙니다. 전체적인 케어가 필요합니다.",
    ]
    random.shuffle(ivory_pool)

    ending = random.choice([
        "지금 시작하세요. 망설이는 시간이 아깝습니다.",
        "혼자 고민하지 마세요. 함께하면 달라집니다.",
        "오늘 상담받고, 내일부터 달라지세요.",
        "첫걸음이 가장 어렵습니다. 그 첫걸음을 함께하겠습니다.",
        "더 늦기 전에 시작하세요. 후회하지 않을 겁니다.",
    ])

    # 과목별 콘텐츠 블록들
    if is_math:
        intros = [
            f"""{city_name_ko} {dong_name}에서 수학 때문에 고민이신가요? 문제를 많이 풀어도 실력이 늘지 않는다면 방법이 잘못된 것입니다. 수학은 개념 이해가 먼저입니다. 공식을 외우기만 해서는 응용 문제를 풀 수 없습니다.

고등학교 수학은 중학교와 차원이 다릅니다. 추상적인 개념이 많아지고, 사고력을 요구하는 문제가 늘어납니다. 학교 수업만으로는 부족한 경우가 많습니다.

많은 학생들이 수학 때문에 힘들어합니다. 하지만 올바른 방법으로 공부하면 누구나 실력을 올릴 수 있습니다. 기초부터 차근차근, 이해 중심으로 학습하면 됩니다.

수학을 잘하면 대학 선택의 폭이 넓어집니다. 문과든 이과든 수학은 중요합니다. 지금부터 준비하면 충분히 목표에 도달할 수 있습니다.""",
            f"""{city_name_ko} {dong_name} 학생 여러분, 수학 성적 때문에 스트레스받고 계신가요? 중학교 때는 잘했는데 고등학교에 와서 갑자기 어려워졌다는 말, 정말 많이 듣습니다.

수학은 계단식 과목입니다. 앞 단계를 완벽히 이해해야 다음 단계로 넘어갈 수 있습니다. 기초에 빈틈이 있으면 점점 더 힘들어집니다.

혼자 공부하면 어디가 문제인지 모를 수 있습니다. 전문가의 도움을 받으면 효율적으로 문제를 해결할 수 있습니다.

학원에서 따라가기 힘들다면 1:1 과외가 답입니다. 본인의 속도에 맞춰 공부할 수 있습니다.""",
        ]
        why_tutor = """1:1 과외의 가장 큰 장점은 맞춤 수업입니다. 학생의 수준에 맞춰 진도를 조절합니다. 이해가 안 되면 더 설명하고, 이해했으면 다음으로 넘어갑니다.

질문을 바로 할 수 있습니다. 모르는 게 생기면 그 자리에서 해결합니다. 학원에서는 질문하기가 어렵습니다.

학생의 약점을 정확히 파악할 수 있습니다. 어떤 유형에서 자주 틀리는지, 어떤 개념이 부족한지 선생님이 알고 있습니다.

학습 습관도 잡아드립니다. 혼자 공부할 때 어떻게 해야 하는지 알려드립니다. 진정한 실력 향상은 자기주도 학습에서 나옵니다."""
        study_method = """수학 공부의 핵심은 개념 이해입니다. 공식만 외워서는 응용 문제를 풀 수 없습니다. 왜 그런 공식이 나오는지 알아야 합니다.

문제 풀이는 양보다 질입니다. 많이 푸는 것보다 제대로 푸는 게 중요합니다. 한 문제를 풀더라도 풀이 과정을 깔끔하게 쓰세요.

오답 정리는 필수입니다. 틀린 문제는 반드시 다시 풀어봐야 합니다. 왜 틀렸는지 분석하세요.

복습을 습관화하세요. 한 번 배운 내용도 안 보면 잊어버립니다. 누적 복습이 실력 향상의 비결입니다."""
        grade_strategy = """학년별로 전략이 다릅니다. 고1은 기초를 다지는 시기입니다. 중학교 내용에 빈틈이 있다면 먼저 메워야 합니다.

고2는 심화 학습을 시작합니다. 수학 I, 수학 II의 내용을 충실히 학습하세요. 여기서 배우는 개념들이 수능에 자주 출제됩니다.

고3은 정리와 실전 연습의 시기입니다. 기출문제를 많이 풀어보세요. 자주 나오는 유형을 파악하고 풀이 시간을 단축하세요.

내신과 수능의 균형도 중요합니다. 둘 다 잘 봐야 원하는 대학에 갈 수 있습니다."""
        faqs = [
            ("주 몇 회 수업이 좋나요?", "학생 상황에 따라 다릅니다. 기초가 부족하면 주 2-3회, 유지 목적이면 주 1회가 적당합니다."),
            ("내신과 수능 중 뭘 먼저 해야 하나요?", "학년에 따라 다릅니다. 고1-2는 내신 중심으로, 고3은 수능 비중을 높여갑니다."),
            ("수학은 언제부터 준비해야 하나요?", "빠를수록 좋습니다. 기초가 부족하다면 지금 바로 시작하세요."),
            ("선행 학습이 필요한가요?", "무조건적인 선행보다 현재 단계의 완벽한 이해가 더 중요합니다."),
        ]
        # 추가 섹션들
        extra_sections = [
            ("자주 하는 실수", """학생들이 자주 하는 실수를 알려드립니다. 가장 흔한 건 계산 실수입니다. 급하게 풀다 보면 부호를 틀리거나 숫자를 잘못 쓰는 경우가 많습니다.

개념을 대충 알고 넘어가는 것도 문제입니다. 이해한 것 같아도 막상 문제에 적용하면 막힙니다. 개념은 완벽하게 이해한 후 넘어가야 합니다.

문제를 끝까지 읽지 않는 실수도 있습니다. 조건을 놓치거나, 묻는 것과 다른 답을 쓰는 경우가 있습니다.

검산을 안 하는 것도 실수입니다. 시간이 없어서 검산을 건너뛰는 학생이 많습니다. 하지만 검산으로 잡을 수 있는 실수가 많습니다."""),
            ("학부모님께 드리는 말씀", """학부모님께 드리는 말씀입니다. 아이의 수학 성적이 안 오른다고 조급해하지 마세요. 수학은 단기간에 실력이 오르기 어려운 과목입니다.

아이가 힘들어할 때 위로해주세요. 수학이 어려운 건 당연한 겁니다. "왜 이것도 못해?"라고 하면 자신감이 떨어집니다.

학습 환경을 만들어주세요. 조용히 공부할 수 있는 공간, 필요한 교재, 충분한 수면이 중요합니다.

선생님과 소통하세요. 아이의 학습 상황을 정기적으로 확인하세요."""),
            ("시험 대비 전략", """시험 대비 방법을 알려드립니다. 시험 2주 전부터 본격적으로 준비하세요. 교과서와 수업 노트를 다시 읽고, 핵심 개념을 정리하세요.

기출문제를 풀어보세요. 학교 시험은 출제 경향이 있습니다. 기출을 분석하면 어떤 유형이 자주 나오는지 알 수 있습니다.

약한 단원을 집중 공략하세요. 모든 단원을 똑같이 공부하면 비효율적입니다.

시험 전날은 새로운 걸 하지 마세요. 이미 아는 내용을 다시 확인하는 정도로 하세요."""),
            ("개념 학습의 중요성", """수학은 개념이 전부입니다. 공식만 외워서는 한계가 있습니다. 왜 이런 공식이 나오는지 알아야 합니다.

개념서를 꼼꼼히 읽으세요. 교과서도 좋고, 시중 개념서도 좋습니다. 중요한 건 꼼꼼히 읽는 것입니다.

예제를 충분히 풀어보세요. 개념을 읽었다고 다 아는 게 아닙니다. 예제를 직접 풀어봐야 진짜 이해한 것입니다.

개념은 반복해서 봐야 합니다. 한 번 봤다고 완벽히 아는 게 아닙니다. 주기적으로 다시 보세요."""),
        ]
    else:  # english
        intros = [
            f"""{city_name_ko} {dong_name}에서 영어 성적 때문에 고민이신가요? 단어만 외운다고 영어 실력이 늘지 않습니다. 문법을 알아야 문장을 정확히 해석할 수 있습니다.

고등학교 영어는 중학교와 차원이 다릅니다. 지문이 길어지고 어휘 수준도 높아집니다. 학교 수업만으로는 부족한 경우가 많습니다.

영어는 꾸준함이 답입니다. 하루에 많이 하는 것보다 매일 조금씩 하는 게 효과적입니다. 지금 시작하면 분명히 달라집니다.

영어를 잘하면 수능에서 유리합니다. 절대평가라고 해도 1등급을 받아야 경쟁력이 있습니다.""",
            f"""{city_name_ko} {dong_name} 학생 여러분, 영어 공부 어떻게 해야 할지 모르겠나요? 많은 학생들이 영어를 어려워합니다.

문법을 알아야 문장을 이해할 수 있습니다. 어휘력이 있어야 글을 읽을 수 있습니다. 이 두 가지가 균형 있게 갖춰져야 합니다.

혼자 공부하면 어떻게 해야 할지 막막할 수 있습니다. 전문가의 도움을 받으면 효율적으로 공부할 수 있습니다.

영어는 언어입니다. 언어는 매일 접해야 늡니다. 매일 조금씩이라도 영어를 보고 듣고 읽어야 합니다.""",
        ]
        why_tutor = """1:1 과외의 장점은 맞춤 수업입니다. 학생의 현재 수준에 맞춰 시작합니다. 어휘가 부족한지, 문법이 약한지 파악합니다.

모르는 단어나 문법을 바로 질문할 수 있습니다. 수업 중에 이해 안 되면 그 자리에서 해결합니다.

학교 시험 대비도 확실히 합니다. 학교마다, 선생님마다 출제 스타일이 다릅니다. 교과서 본문을 완벽히 익힙니다.

학습 습관도 잡아드립니다. 매일 단어 외우는 방법, 효율적인 독해 방법 등을 알려드립니다."""
        study_method = """영어 공부의 기본은 어휘입니다. 단어를 모르면 문장을 읽어도 이해할 수 없습니다. 매일 꾸준히 단어를 외우세요.

단어는 문장과 함께 외우세요. 단어만 달달 외우면 금방 잊어버립니다. 예문과 함께 보면 기억에 오래 남습니다.

문법은 뼈대입니다. 문장 구조를 파악하는 능력이 독해의 핵심입니다. 기본 문법을 확실히 익히세요.

독해는 연습량이 중요합니다. 처음에는 느려도 괜찮습니다. 정확하게 읽는 연습을 먼저 하세요."""
        grade_strategy = """학년별 전략을 알려드립니다. 고1은 기초를 다지는 시기입니다. 중학교 문법에 빈틈이 있다면 먼저 메우세요.

고2는 실력을 쌓는 시기입니다. 어휘력을 확장하고, 다양한 유형의 글을 읽어보세요.

고3은 정리와 실전 연습의 시기입니다. 부족한 부분을 집중 보완하고, 기출문제를 많이 풀어보세요.

EBS 연계 교재를 잘 활용하세요. 수능에 연계되는 교재입니다."""
        faqs = [
            ("단어는 하루에 몇 개씩 외워야 하나요?", "무리하지 않는 선에서 매일 꾸준히 하는 게 중요합니다. 보통 하루 30-50개 정도가 적당합니다."),
            ("문법 공부가 꼭 필요한가요?", "네, 문법은 영어의 뼈대입니다. 기본 문법은 확실히 익혀야 합니다."),
            ("영어 듣기는 어떻게 준비하나요?", "매일 조금씩 듣는 게 중요합니다. EBS 연계 교재 듣기 파일을 활용하면 좋습니다."),
            ("수능 영어 1등급 가능한가요?", "물론입니다. 체계적으로 준비하면 충분히 가능합니다."),
        ]
        extra_sections = [
            ("독해 실력 향상 팁", """독해 실력을 올리는 방법을 알려드립니다. 먼저 문제를 보고 지문을 읽으세요. 무엇을 묻는지 알고 읽으면 핵심을 빠르게 찾을 수 있습니다.

첫 문장과 마지막 문장에 주목하세요. 대부분 주제나 결론이 담겨 있습니다.

연결어를 주목하세요. however, therefore 같은 연결어는 글의 흐름을 보여줍니다.

모르는 단어에 너무 집착하지 마세요. 전체 맥락에서 의미를 추측해보세요."""),
            ("학부모님께 드리는 말씀", """학부모님께 드리는 말씀입니다. 영어는 꾸준함이 중요합니다. 단기간에 실력이 확 오르기 어렵습니다.

아이가 영어를 어려워할 때 격려해주세요. 비난하면 자신감이 떨어지고 영어가 더 싫어집니다.

매일 영어에 노출될 수 있는 환경을 만들어주세요. 영어 책, 영어 영상 등을 자연스럽게 접할 수 있게 해주세요.

선생님과 소통하세요. 아이의 학습 상황을 정기적으로 확인하세요."""),
            ("단어 암기 비법", """단어 암기 방법을 알려드립니다. 단어장만 보지 마세요. 실제 문장에서 단어를 만나야 기억에 남습니다.

어원을 알면 도움이 됩니다. 접두사, 접미사, 어근을 알면 처음 보는 단어도 의미를 추측할 수 있습니다.

반복이 핵심입니다. 한 번에 많이 외우기보다 여러 번 반복해서 보세요.

자기 전에 외우면 효과적입니다. 잠자는 동안 뇌가 정보를 정리합니다."""),
            ("문법 학습 가이드", """문법은 영어의 뼈대입니다. 문법 없이는 정확한 해석이 불가능합니다.

기본 문법부터 확실히 하세요. 문장의 5형식, 시제, 수동태, 관계대명사가 기본입니다.

문법 문제를 많이 풀어보세요. 이론만 알면 안 됩니다. 문제를 통해 적용하는 연습을 해야 합니다.

틀린 문법 문제는 다시 보세요. 왜 틀렸는지 분석하세요."""),
        ]

    intro = random.choice(intros)

    # 기본 콘텐츠 조립 (short: 약 200줄)
    lines = []
    lines.append(f'''---
title: "{city_name_ko} {dong_name} {level_ko} {subject_ko}과외 | 내신·수능 맞춤 수업"
date: {datetime.now().strftime("%Y-%m-%d")}
categories:
- {level_ko}교육
- {subject_ko}
tags:
- {city_name_ko}
- {dong_name}
- {level_ko}{subject_ko}과외
- {subject_ko}과외
- 내신대비
- 수능대비
description: "{city_name_ko} {dong_name} 지역 {level_ko} {subject_ko} 과외 전문. 학생 맞춤 1:1 수업으로 내신과 수능을 동시에 준비합니다."
featured_image: "https://images.unsplash.com/{image}?w=1200&h=630&fit=crop"
---

{intro}

{make_ivory_box(ivory_pool[0])}

## 1:1 과외가 효과적인 이유

{why_tutor}

{make_ivory_box(ivory_pool[1])}

## 효과적인 학습 방법

{study_method}

{make_ivory_box(ivory_pool[2])}

## 학년별 학습 전략

{grade_strategy}

{make_ivory_box(ivory_pool[3])}''')

    # 사이즈에 따라 추가 섹션 삽입
    extra_count = {"short": 0, "medium": 1, "long": 2, "extra_long": 3}[size]
    random.shuffle(extra_sections)
    ivory_idx = 4

    for i in range(extra_count):
        if i < len(extra_sections):
            title, content = extra_sections[i]
            lines.append(f'''

## {title}

{content}

{make_ivory_box(ivory_pool[ivory_idx % len(ivory_pool)])}''')
            ivory_idx += 1

    # 수업료 안내 이후 부분
    lines.append(f'''

## 수업료 안내

{city_name_ko} {dong_name} 지역 {level_ko} {subject_ko} 과외 수업료입니다.

**{level_ko}학생** 기준으로 {cost_main} 선입니다.

정확한 비용은 학생의 현재 수준과 목표에 따라 달라질 수 있습니다. 상담을 통해 최적의 수업 횟수와 비용을 안내해 드리겠습니다.

{make_ivory_box(ivory_pool[ivory_idx % len(ivory_pool)])}

{{{{< cta-dual type="final" >}}}}

## 자주 묻는 질문

**Q. {faqs[0][0]}**

{faqs[0][1]}

**Q. {faqs[1][0]}**

{faqs[1][1]}

{make_ivory_box(ivory_pool[(ivory_idx + 1) % len(ivory_pool)])}

**Q. {faqs[2][0]}**

{faqs[2][1]}

**Q. {faqs[3][0]}**

{faqs[3][1]}

## 마무리

{city_name_ko} {dong_name} {level_ko} {subject_ko}, {ending}

{make_ivory_box(ivory_pool[(ivory_idx + 2) % len(ivory_pool)])}
''')

    return '\n'.join(lines)

def main():
    total_files = 0
    line_stats = {"200-250": 0, "251-300": 0, "301-350": 0, "351-400": 0}

    for city_id, city_info in CITIES.items():
        city_path = os.path.join(BASE_PATH, city_id)
        print(f"\n=== {city_info['name_ko']} ({city_id}) ===")

        file_index = 0
        for dong in city_info["dongs"]:
            dong_path = os.path.join(city_path, dong)
            os.makedirs(dong_path, exist_ok=True)

            index_file = os.path.join(dong_path, "_index.md")
            with open(index_file, 'w', encoding='utf-8') as f:
                f.write(f'''---
title: "{dong} 과외"
---
''')

            for level in ["middle", "high"]:
                for subject in ["math", "english"]:
                    size = get_target_range()
                    content = generate_content(
                        city_info['name_ko'], dong, subject, level, size, file_index
                    )

                    filename = f"{level}-{subject}.md"
                    filepath = os.path.join(dong_path, filename)

                    with open(filepath, 'w', encoding='utf-8') as f:
                        f.write(content)

                    actual_lines = content.count('\n') + 1

                    if actual_lines <= 250:
                        line_stats["200-250"] += 1
                    elif actual_lines <= 300:
                        line_stats["251-300"] += 1
                    elif actual_lines <= 350:
                        line_stats["301-350"] += 1
                    else:
                        line_stats["351-400"] += 1

                    total_files += 1
                    file_index += 1

            print(f"  {dong}: 4개 파일 생성")

    print(f"\n=== 완료 ===")
    print(f"총 {total_files}개 파일 생성")
    print(f"\n줄 수 분포:")
    for range_name, count in line_stats.items():
        pct = count / total_files * 100 if total_files > 0 else 0
        print(f"  {range_name}줄: {count}개 ({pct:.1f}%)")

if __name__ == "__main__":
    main()
